{
	id: "particle_controller",
	hidden_in_game: true,
	is_strict: true,

	properties: {
		_type: { type: "string", set: "[set(_data, value), set(particles, get_document(sprintf('data/particles/%s.cfg', value)))]" },

		emission_rate: {
			variable: false,
			type: "any",
			set: "set(particles.emission_rate, value) asserting particles != null",
			get: "particles.emission_rate asserting particles != null",
		},

		fade_away_and_die: "def(int ncycles=20) ->commands
		execute(me,
		animate(me, {
			emission_rate: 0.0,
		}, {
			duration: ncycles,
			on_complete: remove_object(me)
		})
		)
		",

		follow_obj: { type: "null|custom_obj" },
	},
	
	events: {
		process: "
		if(follow_obj != null, [
			set(x, follow_obj.mid_x),
			set(y, follow_obj.mid_y),
		])",
	},
}
