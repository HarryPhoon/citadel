{
id: "choice_controller",
is_human: false,
is_strict: true,
always_active: true,

vars: {
},

tmp: {
	children: [],
	game: null,
},

properties: {
	destroy_children: "def() [map(tmp.children, remove_object(value)),
	                          set(tmp.children, [])]",
	destroy: "def() [destroy_children(), remove_object(me)]",

	level_width: "level.dimensions[2]",
	level_height: "level.dimensions[3]",

	game: {
		set: "[
			set(zorder, 1000),
			set(draw_area, [0,0,level.dimensions[2]/2 + 20, level.dimensions[3]/2 + 20]),
			execute(me, map(range(24), schedule(value, set(alpha, value*8)))),
			map(cards, spawn('card', 100 + ((index*100)/(size(cards)-1)*(level_width-200))/100, level_height/2, 1, [
				debug('spawn card ' + index + '/' + size(cards)),
				set(child.vars.is_choice, true),
				set(child.vars.choice_value, value.value),
				set(child.zorder, 2000),
				set(child.card_type, if(is_string(value.card), construct('card', get_document('data/cards.cfg')[value.card]), value.card)),
				add(tmp.children, [child]),
		   ]))
	    where cards = filter(value.current_choice.options, value.type = 'card'),

		set(tmp.game, value),
 	]",
		get: "tmp.game",
	},
},

animation: {
	id: "normal",
	image: "dark-solid.png",
	x: 0,
	y: 0,
	w: 3,
	h: 3,
	frames: 1,
	duration: 1000,
},

}
