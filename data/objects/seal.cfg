{
	id: "seal",
	is_strict: true,
	always_active: true,

	properties: {
		size: { default: 64.0 },
		circle_radius: { default: 0.4 },

		player_num: { type: "int" },
		lane_num: { type: "int" },

		left_shard: { type: "null|bool" },
		right_shard: { type: "null|bool" },

		scaling: { type: "decimal", get: "size/512.0", set: "[set(size, 512*value)]", variable: false },

		icon: { type: "string" },

		shatter_animation: "def() ->commands [

			spawn('seal', mid_x, mid_y, {
				icon: icon,
				zorder: zorder,
				player_num: player_num,
				lane_num: lane_num,
				left_shard: true,
			}, [

				animate(child, {
					mid_x: mid_x - 40,
					rotate: rotate - 30,
				}, {
					name: 'anim',
					duration: 50,
				}),

				animate(child, {
					alpha: 0,
				}, {
					name: 'anim',
					duration: 50,
					on_complete: remove_object(child),
				}),

			]),

			spawn('seal', mid_x, mid_y, {
				icon: icon,
				zorder: zorder,
				player_num: player_num,
				lane_num: lane_num,
				right_shard: true,
			}, [

				animate(child, {
					mid_x: mid_x + 40,
					rotate: rotate + 30,
				}, {
					name: 'anim',
					duration: 50,
				}),

				animate(child, {
					alpha: 0,
				}, {
					name: 'anim',
					duration: 50,
					on_complete: remove_object(child),
				}),

			]),
		]",

		_update_canvas: "def() ->commands [

		set(animation, {
			id: 'svg',
			image: 'svg',
			fbo: c.render(int(scaling*512), int(scaling*512),
			[
				if(left_shard or right_shard, [
					//the shard fracture line.
					c.save(),
					c.move_to(scaling*512*0.5, scaling*512*0.1),
					c.line_to(scaling*512*0.5, scaling*512*0.5),
					c.line_to(scaling*512*0.6, scaling*512*0.4),
					c.line_to(scaling*512*0.6, scaling*512*0.9),
					c.set_line_width(1.5),
					c.set_source_rgba(1, 1, 1, 1),
					c.stroke(),
					c.restore(),
				]),

				if(left_shard, [

					c.move_to(scaling*512*0.0, scaling*512*0.0),
					c.line_to(scaling*512*0.5, 0),
					c.line_to(scaling*512*0.5, scaling*512*0.5),
					c.line_to(scaling*512*0.6, scaling*512*0.4),
					c.line_to(scaling*512*0.6, scaling*512*1.0),
					c.line_to(scaling*512*0.0, scaling*512*1.0),
					c.line_to(scaling*512*0.0, scaling*512*0.0),

					c.clip(),
					c.new_path(),
				]),

				if(right_shard, [

					c.move_to(scaling*512*1.0, scaling*512*0.0),
					c.line_to(scaling*512*0.5, 0),
					c.line_to(scaling*512*0.5, scaling*512*0.5),
					c.line_to(scaling*512*0.6, scaling*512*0.4),
					c.line_to(scaling*512*0.6, scaling*512*1.0),
					c.line_to(scaling*512*1.0, scaling*512*1.0),
					c.line_to(scaling*512*1.0, scaling*512*0.0),

					c.clip(),
					c.new_path(),
				]),

				c.save(),

				c.translate(128*scaling, 128*scaling),
				c.scale(scaling/2, scaling/2),

				c.draw_svg('images/icons/' + icon),

				c.restore(),

				c.arc(scaling*512/2, scaling*512/2, scaling*512*circle_radius, 0, 2*3.15),
				c.set_line_width(1.5),
				c.set_source_rgba(1, 1, 1, 1),
				c.stroke(),
			] where shard_break = [
			]
			) where c = canvas(),
			x: 0,
			y: 0,
			w: int(scaling*512),
			h: int(scaling*512),
			scale: 1.0,
			frames: 1,
			duration: -1,
		}),

		set(mid_x, mid_x),
		set(mid_y, mid_y),
		]
		
		",
	},

	on_create: "_update_canvas()",
}
