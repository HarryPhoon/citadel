{
id: "crypt_library_display",
is_strict: true,
hidden_in_game: false,
always_active: true,

properties: {
	_text: { type: "string" },
	items: { type: "[string]" },
	num_items: "int :: size(items)",
	_width: { type: "int" },
	_height: { type: "int" },

	controller: { type: "obj citadel_controller" },

	item_objects: { type: "[obj card]", default: [] },

	create_card_objects: "def([string] items, [obj card] objects) ->commands
		if(items = [], ; null, //set(item_objects, filter(item_objects, value in objects)),
			if(obj != null,
			   create_card_objects(items[1:], filter(objects, value != obj)),

			   [
			   debug('ZZZ CREATE NEW'),
			   add(item_objects, [
				   object('card', 0, 0, {
					card_type: lib.citadel.create_card(item),
					controller: controller,
					in_hand: false,
					card_size: 1.0,
				   })
			   ]),

				create_card_objects(items[1:], objects),
			   ]
			)
			where obj = find(objects, value.card_type.name = item)
			where item = items[0]
		)
	",

	is_crypt: { type: "bool" },
	player_index: { type: "int" },

	_font: { type: "string", init: "lib.font.regular_font" },
	_font_size: { default: 18 },
	_left_align: { default: true, type: "bool" },

	highlight: { default: false, set: "if(_data != value, [set(_data, value), fire_event('create')])" },

	_card: { type: "null|obj card" },

	px: "def(int pixels) ->int int(pixels*(_height/28.0))",

	render: "def() ->commands
	set(animation,
	lib.citadel.render_frame(c, _width, _height, [
		c.rectangle(0, 0, _width, _height),
		c.set_source_rgba(0.65, 0.63, 0.60, 1),
		c.fill(),

		c.set_source_rgba(0, 0, 0, 1),

		c.translate(_width*0.15, _height*0.7),
		c.set_font(lib.font.regular_font),
		c.set_font_size(lib.citadel.py(18)),
		c.text_path_in_bounds(str(num_items), _width*0.7, [if(_left_align, 'left', 'right')]),
		c.fill(),


	]) where c = canvas()
	)
	",
},

on_create: "[
	debug(['ZZZ CREATE WITH', size(items), size(item_objects)]),
	set(x, x),
	set(y, y),

	render(),

	create_card_objects(items, item_objects),
/*
	spawn('card', 0, 0, {
		mid_x: mid_x,
		mid_y: mid_y,
		card_type: lib.citadel.create_card('Acolyte'),
		show_back: true,
		card_size: 1.0,
		zorder: me.zorder,
		controller: controller,
		mouse_enter_handler: def() ->commands controller.mouse_enter_crypt_library_display(me),
		mouse_leave_handler: def() ->commands controller.mouse_leave_crypt_library_display(me),
	}, [
		set(_card, child),
	]),
	*/
]",

on_type_updated: "fire_event('create')",

on_being_removed: "map(spawned_children, remove_object(value))",

on_mouse_enter: "[
	if(ctrl, ctrl.mouse_enter_crypt_library_display(me))
] where ctrl = find(level.chars, value is obj citadel_controller)",

on_mouse_leave: "[
	if(ctrl, ctrl.mouse_leave_crypt_library_display(me))
] where ctrl = find(level.chars, value is obj citadel_controller)",

}
