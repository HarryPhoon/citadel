{
	id: "nehwon_campaign_controller",
	prototype: ["story_campaign_controller"],

	is_human: true,

	properties: {
        
        player_collection: { type: "[string]", default: ["Rihn's Anointed", "Disciple", "Temple Guard", "Blessing of Endurance", "Weakness", "Pasture", "Dawn Obelisk", "Zombie", "Skeleton", "Vampire", "Hypothermia", "Deathly Arrow", "Swamp", "Duskwind Obelisk", "Acolyte", "Mystic Scholar", "Cunning Wisp", "Fireball", "Counter Spell", "Mistlands", "Library", "Mercenary", "Royal Armourer", "Thunderer", "Anthem of Battle", "Toughness", "Mine", "Highlands", "Savage Wolf", "Guardian Tunneler", "Cave Troll", "Furious Rampage", "Cover", "Forest", "Savage Lands", "Rokh", "Blessed Lance", "Dark Emissary", "Flesh Golem", "Pain", "Chain Lightning", "Guard Post", "Staged Duel", "Wolf Rider", "Outsmart the Guards", "Rihn's Anointed", "Disciple", "Temple Guard", "Blessing of Endurance", "Weakness", "Pasture", "Dawn Obelisk", "Zombie", "Skeleton", "Vampire", "Hypothermia", "Deathly Arrow", "Swamp", "Duskwind Obelisk", "Acolyte", "Mystic Scholar", "Cunning Wisp", "Fireball", "Counter Spell", "Mistlands", "Library", "Mercenary", "Royal Armourer", "Thunderer", "Anthem of Battle", "Toughness", "Mine", "Highlands", "Savage Wolf", "Guardian Tunneler", "Cave Troll", "Furious Rampage", "Cover", "Forest", "Savage Lands", "Rokh", "Blessed Lance", "Dark Emissary", "Flesh Golem", "Pain", "Chain Lightning", "Guard Post", "Staged Duel", "Wolf Rider", "Outsmart the Guards", "Rihn's Anointed", "Disciple", "Temple Guard", "Blessing of Endurance", "Weakness", "Pasture", "Dawn Obelisk", "Zombie", "Skeleton", "Vampire", "Hypothermia", "Deathly Arrow", "Swamp", "Duskwind Obelisk", "Acolyte", "Mystic Scholar", "Cunning Wisp", "Fireball", "Counter Spell", "Mistlands", "Library", "Mercenary", "Royal Armourer", "Thunderer", "Anthem of Battle", "Toughness", "Mine", "Highlands", "Savage Wolf", "Guardian Tunneler", "Cave Troll", "Furious Rampage", "Cover", "Forest", "Savage Lands", "Rokh", "Blessed Lance", "Dark Emissary", "Flesh Golem", "Pain", "Chain Lightning", "Guard Post", "Staged Duel", "Wolf Rider", "Outsmart the Guards"] },
        
        player_deck: { type: "[string]", default: ["Guardian Tunneler", "Guardian Tunneler", "Guardian Tunneler", "Cave Troll", "Cave Troll", "Wolf Rider", "Wolf Rider", "Wolf Rider", "Royal Armourer", "Royal Armourer", "Royal Armourer", "Thunderer", "Thunderer", "Thunderer", "Mercenary", "Mercenary", "Mercenary"], },

        
        tilemap: "[string] :: [
		m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, g, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m,
		m, s, s, s, s, s, s, m, b, b, m, b, b, m, b, b, g, m, m, g, m, m, b, b, m, m, g, m, m, b, m, b, m, m, b, b, m, m, b, m,
		m, m, m, m, s, s, s, m, m, b, m, b, b, m, b, m, g, g, m, g, g, g, b, m, m, g, g, b, b, b, m, b, m, b, b, b, b, m, b, m,
		m, b, b, b, m, s, s, s, m, m, b, b, b, m, b, m, g, g, g, g, m, m, g, g, g, m, m, m, b, m, m, g, m, m, m, m, b, m, b, m,
		m, b, b, m, g, s, s, s, s, m, b, m, m, m, b, m, g, m, m, g, m, g, g, m, m, m, m, m, m, g, g, g, g, g, g, g, g, m, b, m,
		m, m, m, g, g, g, g, s, g, b, b, b, b, m, m, m, b, m, m, g, g, g, m, m, m, g, g, g, g, m, m, m, m, g, m, m, m, m, b, m,
		m, g, g, m, g, g, g, g, g, m, b, m, b, b, m, b, b, b, m, g, m, m, m, g, g, m, m, m, m, m, b, b, b, g, g, g, g, g, g, m,
		m, g, m, m, m, m, m, m, m, m, m, g, m, m, m, m, m, m, m, g, m, m, g, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, g, m,
		m, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, s, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, m,
		m, g, g, g, m, m, m, m, m, m, m, m, g, g, g, m, m, g, g, g, g, g, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, g, m,
		m, g, g, g, g, g, g, g, g, g, g, g, g, m, m, g, g, m, m, m, m, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g, g,
		m, g, g, g, m, m, m, m, m, m, m, m, m, g, g, m, m, m, b, b, m, m, m, g, m, m, m, g, g, g, g, g, g, g, g, g, g, g, g, m,
		m, g, m, m, g, g, g, g, g, g, g, g, g, m, m, g, g, m, b, b, b, g, g, m, m, g, g, m, m, m, m, m, m, m, m, m, g, g, g, m,
		m, g, g, g, m, m, m, m, m, m, m, m, m, g, g, m, g, m, m, m, m, g, g, g, g, g, m, b, b, g, g, g, g, g, g, m, m, m, g, m,
		m, g, m, m, g, g, g, m, m, m, m, g, m, g, m, m, g, m, g, g, g, m, m, m, g, g, m, b, m, g, m, g, g, m, b, m, b, b, b, m,
		m, m, g, g, m, m, g, g, m, g, g, m, g, g, m, m, g, g, g, g, g, g, g, m, g, g, m, m, m, g, m, g, g, m, b, m, b, m, m, m,
		m, b, m, m, g, g, m, m, g, g, m, b, m, g, m, m, g, m, m, g, m, m, g, m, g, g, g, g, g, g, m, g, g, m, b, m, b, b, b, m,
		m, b, b, b, g, g, g, g, g, g, m, b, m, g, m, m, g, m, g, g, g, m, g, m, g, m, m, m, m, m, m, g, g, m, b, m, m, m, b, m,
		m, b, b, m, g, g, g, m, g, m, b, m, m, g, g, g, g, m, g, g, g, m, g, g, g, g, g, g, g, g, g, g, g, m, b, b, b, b, b, m,
		m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, g, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m,

		] where b = 'beach'
		  where g = 'grass'
		  where m = 'mountain'
		  where s = 'shallow'",  

		starting_player: "map :: {
			_avatar: 'bronis.png',
			_avatar_focus: [355,355],
			_avatar_scale: 0.1,
			loc: [19,18],
		}",
        
        starting_regions: "[map] :: [
		{
			name: 'Outside the walls',
			loc: [19,17],
			borders: [[19,15]],
			music: 'gaea.ogg',
		},
		{
			name: q(Traveler's Road),
			loc: [19,14],
			borders: [[19,16],[17,15],[23,13],[26,12],[21,15],[38,14],[38,9],[20,12]],
			music: 'materia.ogg',
            encounter_chance: 0.0,
			generate_random_encounter: q(def() ->Scenario {
				name: q(A Real Fight!),
				text: q(Now that you have received some training, you must be dispatched to the Western Forest to battle an incursion of foul beasts. Withstand their rush if you want to win!),
				bot_args: {
					deck: q([string] :: ['Green Adder', 'Wolf']*6),
				},
				enemy_name: choose([q(Ichi), q(Isil), q(Igor), q(Ivar)]),
				set: 'core',
				bot: 'scenario2.cfg',
				bot_type: 'eval',
				portrait: 'wolf-rider.png',
				portrait_scale: 0.2,
				portrait_translate: [306, 457],
				avatar: 'marauder.png',

				theme: 'mist',
				storyline: 'storyline_real_fight',
				music_theme: 'gaea',
				reward_gold: 120,
			}
			)
		},
        {
			name: q(Traveler's Road),
			loc: [32,10],
			borders: [[26,10],[26,12],[38,9],[38,14]],
			music: 'entropia.ogg',
		},
        {
			name: 'Guild of Thieves and Slayers',
			loc: [18,12],
			borders: [[21,12]],
			music: 'entropia.ogg',
		},
        {
			name: 'Lowtown',
			loc: [25,15],
			borders: [[22,13],[27,11],[20,15],[34,14]],
			music: 'materia.ogg',
		},
        {
			name: 'Sewers',
			loc: [34,16],
			borders: [[38,13],[34,14]],
			music: 'materia.ogg',
		},
        {
			name: 'Scholar Quarters',
			loc: [16,15],
			borders: [[18,15],[10,15]],
			music: 'materia.ogg',
		},
        {
			name: 'Southwest Plaza',
			loc: [5,16],
			borders: [[18,15],[11,14],[7,15],[3,13],[3,17],[1,11]],
			music: 'materia.ogg',
		},
        {
			name: 'East Temple Street',
			loc: [29,8],
			borders: [[38,9],[38,7],[22,8]],
			music: 'aether.ogg',
		},
        {
			name: 'Temple Square',
			loc: [19,7],
			borders: [[23,10],[22,7],[22,8],[19,6],[16,8],[16,10]],
			music: 'aether.ogg',
		},
        {
			name: 'West Temple Street',
			loc: [11,12],
			borders: [[17,9],[3,11]],
			music: 'aether.ogg',
		},
        {
			name: 'Smith Street',
			loc: [5,14],
			borders: [[2,13],[8,16]],
			music: 'materia.ogg',
		},
        {
			name: 'Adbandoned Villa',
			loc: [1,17],
			borders: [[3,17]],
			music: 'entropia.ogg',
		},
        {
			name: 'West Plaza',
			loc: [1,9],
			borders: [[4,12],[1,12],[5,10],[5,8],[1,6]],
			music: 'materia.ogg',
		},
        {
			name: 'Military Quarters',
			loc: [12,9],
			borders: [[17,8],[4,10],[3,8]],
			music: 'materia.ogg',
		},
        {
			name: q(King's Hill),
			loc: [5,5],
			borders: [[1,7],[3,3],[9,5]],
			music: 'materia.ogg',
		},
        {
			name: q(Lord Wazjier's Villa),
			loc: [1,3],
			borders: [[4,4]],
			music: 'sapienza.ogg',
		},
        {
			name: q(The King's Palace),
			loc: [11,3],
			borders: [[9,5]],
			music: 'materia.ogg',
		},
        {
			name: 'Industrial District',
			loc: [33,4],
			borders: [[38,8],[22,8]],
			music: 'materia.ogg',
		},
        {
			name: 'Uptown',
			loc: [19,3],
			borders: [[19,6]],
			music: 'gaea.ogg',
		},
		]",
        
		starting_locations: "[map] :: [

		{
			title: q(Meditation: Power),
			flavor_text: q(Outside the walls you're safe enough to meditate and to organise your magics into a cohesive flow. Choose carefully what powers you'll wield as there are not many safe places inside the city for you to change.),
			_avatar: 'greatlibrary.png',
			_avatar_focus: [400,400],
			_avatar_scale: 0.2,
			loc: [18,18],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Edit Deck',
					on_select: def()->commands controller.show_library(),
				}]),
			},
		},

		{
			title: q(Entrance Campers),
			flavor_text: q(The traders who have managed to seize control of the ground near the entrane always overcharge their goods knowing that naive travelers will pay without knowing any better. Still in these convieneintly accessable halls one can find showy high quality magics.),
			_avatar: 'bazaar.png',
			_avatar_focus: [650,250],
			_avatar_scale: 0.2,
			loc: [18,14],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Wall of Stone), quantity: 3, price: 15},
					  {type: q(Rally the People), quantity: 3, price: 40},
					  {type: q(Translocate), quantity: 3, price: 80},
					  {type: q(Astral Walk), quantity: 3, price: 50},
					  {type: q(Battlecry), quantity: 3, price: 40},
					  {type: q(Guardian King), quantity: 3, price: 100},
					  {type: q(Silence), quantity: 3, price: 40},
					  {type: q(Lady Meira, the Hopeful), quantity: 3, price: 350},
					  {type: q(Blood Altar), quantity: 3, price: 60},
					  {type: q(Grave Stalker), quantity: 3, price: 50},
					]),
				}]),
			},
		},

		{
			title: q(Meditation: Rest),
			flavor_text: q(Given time and security you can mend your wounds but inside the walls you'll find little of either is freely available. Take this time to refresh your body and prepare.),
			_avatar: 'blessing-of-endurance.png',
			_avatar_focus: [400,400],
			_avatar_scale: 0.2,
			loc: [20,18],
			info: {
				handle_enter: q(def(obj story_campaign_controller controller, obj campaign_location loc) ->commands [
					controller.heal_wounds(),
				]),
			},
		},
        
        {
			title: q(Greedy Guards),
			flavor_text: q(You see travler, if you wish to do buisness in Marlank you must pay the special Sargent Mork tarriff which for a scruffy guy like you will be 50 gold.),
			_avatar: 'city-watch.png',
			_avatar_scale: 0.2,
			_avatar_focus: [420, 250],
			loc: [19,16],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Carve your way through',
					on_select: def()->commands controller.force_fight([19,16], {

						name: q(Greedy Guards),
						text: q(These guards are trying to shake you down.),
						bot_args: {
							deck: q([string] :: ['City Watchman', 'Wall of Stone']*10 + ['Guard Post', 'Watch Sargent']*5),
						},
						enemy_name: q(Sargent Mork),
						set: 'Scum_of_Marlank',
						loc: [19,16],
						portrait: 'city-watch.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'mercenary.png',

						theme: 'marlank',
						music_theme: 'materia',
						reward_gold: 45,
					}, me),
				},
                {
                    button_text: 'Pay the bribe (-50 gold)',
                    on_select: def()->commands 
                       [controller.spend_gold(50),
                        controller.remove_location([19,16]),
                        controller.update_visibility(),
                       ],
                },       
                ])
			},
		},
        
        {
			title: q(Guard Thug),
			flavor_text: q(Eh, go away! This is a restricted area.),
			_avatar: 'cutthroat.png',
			_avatar_scale: 0.2,
			_avatar_focus: [450, 300],
			loc: [20,12],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Challenge',
					on_select: def()->commands controller.force_fight([20,12], {

						name: q(Out thugging.),
						text: q(This lout is trying to stop you from entering the thieves guild.),
						bot_args: {
							deck: q([string] :: ['Cut-Throat', 'Cunning Rogue', 'Mercenary']*10 + ['Anthem of Battle', 'Tactical Maneuver']*5),
						},
						enemy_name: q(Sinstral Jack),
						set: 'Scum_of_Marlank',
						loc: [20,12],
						portrait: 'cutthroat.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'cutthroat.png',

						theme: 'marlank',
						music_theme: 'materia',
						reward_gold: 50,
                        
                        starting_units: [
			                 {card_name: 'Thieves Guild', loc: [2,4], controller: 1},

			                 {card_name: 'Village', loc: [1,1], controller: -1},
                             {card_name: 'Village', loc: [2,3], controller: -1},
			                 {card_name: 'Village', loc: [3,1], controller: -1},
		                              ],
					}, me),
				},
                ])
			},
		},
        
        {
			title: q(Library Enforcer),
			flavor_text: q(Go away stranger. We of the scholar's district don't like scruffy thugs wandering around our quarters. If you can't show you know something then go away.),
			_avatar: 'acolyte.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [17,15],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Challenge',
					on_select: def()->commands controller.force_fight([17,15], {

						name: q(I know something),
						text: q(He said he want's you to show him you know something.),
						bot_args: {
							deck: q([string] :: ['Acolyte', 'Mystic Scholar', 'Flesh Golem', 'Disciple', 'Temple Guard', 'Weakness']*5 + ['Fireball', 'Astral Walk', 'Chain Lightning', 'Library', 'Dawn Obelisk']*2),
						},
						enemy_name: q(Ser Valadis),
						set: 'Scum_of_Marlank',
						loc: [17,15],
						portrait: 'acolyte.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'acolyte.png',

						theme: 'marlank',
						music_theme: 'aether',
						reward_gold: 70,
					}, me),
				},
                ])
			},
		},
        {
			title: q(West Vytes),
			flavor_text: q(This is Vyte turf. Come in and I can't guarentee you'll leave with anything.),
			_avatar: 'cutthroat.png',
			_avatar_scale: 0.2,
			_avatar_focus: [450, 300],
			loc: [21,15],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Challenge',
					on_select: def()->commands controller.force_fight([21,15], {

						name: q(Try it Punk),
						text: q(What is a Vyte?),
						bot_args: {
							deck: q([string] :: ['Scavenging Opportunist',]*40 + ['Tactical Maneuver', 'Outsmart the Guards', 'Toughness']*8 + ['Thieves Guild']*2),
						},
						enemy_name: q(The Vytes),
						set: 'Scum_of_Marlank',
						loc: [21,15],
						portrait: 'cutthroat.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'cutthroat.png',

						theme: 'marlank',
						music_theme: 'materia',
						reward_gold: 30,
                        
                        starting_units: [
			                 {card_name: 'Thieves Guild', loc: [1,3], controller: 1},
                             {card_name: 'Thieves Guild', loc: [3,3], controller: 1},
                             {card_name: 'Mine', loc: [2,4], controller: 1},

			                 {card_name: 'Village', loc: [0,1], controller: -1},
                             {card_name: 'Village', loc: [4,1], controller: -1},
                             {card_name: 'Village', loc: [2,3], controller: 1},
		                              ],
                                      
                        trophies: [
			                 [0,0,0,0,0],
			                 [5,5,5,5,5],
		                          ],
					}, me),
				},
                ])
			},
		},
        {
			title: q(East Vytes),
			flavor_text: q(This is Vyte turf. Come in and I can't guarentee you'll leave with anything.),
			_avatar: 'cutthroat.png',
			_avatar_scale: 0.2,
			_avatar_focus: [450, 300],
			loc: [23,18],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Challenge',
					on_select: def()->commands controller.force_fight([23,18], {

						name: q(Turf Wars),
						text: q(Vytes are annoying),
						bot_args: {
							deck: q([string] :: ['Scavenging Opportunist',]*40 + ['Tactical Maneuver', 'Outsmart the Guards', 'Toughness']*8 + ['Thieves Guild']*2),
						},
						enemy_name: q(The Vytes),
						set: 'Scum_of_Marlank',
						loc: [23,18],
						portrait: 'cutthroat.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'cutthroat.png',

						theme: 'marlank',
						music_theme: 'materia',
						reward_gold: 30,
                        
                        starting_units: [
			                 {card_name: 'Thieves Guild', loc: [1,3], controller: 1},
                             {card_name: 'Thieves Guild', loc: [3,3], controller: 1},
                             {card_name: 'Mine', loc: [2,4], controller: 1},

			                 {card_name: 'Village', loc: [0,1], controller: -1},
                             {card_name: 'Village', loc: [4,1], controller: -1},
                             {card_name: 'Village', loc: [2,3], controller: 1},
		                              ],
                                      
                        trophies: [
			                 [0,0,0,0,0],
			                 [5,5,5,5,5],
		                          ],
					}, me),
				},
                ])
			},
		},
        {
			title: q(Vyte Boss),
			flavor_text: q(What ya don mess'n wit mah turf?),
			_avatar: 'cutthroat.png',
			_avatar_scale: 0.2,
			_avatar_focus: [450, 300],
			loc: [22,17],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Challenge',
					on_select: def()->commands controller.force_fight([22,17], {

						name: q(Turf Wars),
						text: q(Vytes are annoying),
						bot_args: {
							deck: q([string] :: ['Scavenging Opportunist',]*54 + ['Tactical Maneuver', 'Outsmart the Guards', 'Toughness', 'Rally the People']*12 + ['Thieves Guild']*3),
						},
						enemy_name: q(Vyke Vyte the Fighter),
						set: 'Scum_of_Marlank',
						loc: [22,17],
						portrait: 'cutthroat.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'cutthroat.png',

						theme: 'marlank',
						music_theme: 'materia',
						reward_gold: 70,
                        
                        starting_units: [
			                 {card_name: 'Thieves Guild', loc: [1,3], controller: 1},
                             {card_name: 'Thieves Guild', loc: [3,3], controller: 1},
                             {card_name: 'Mine', loc: [0,3], controller: 1},
                             {card_name: 'Mine', loc: [2,4], controller: 1},
                             {card_name: 'Mine', loc: [4,3], controller: 1},

			                 {card_name: 'Village', loc: [0,1], controller: -1},
                             {card_name: 'Village', loc: [4,1], controller: -1},
                             {card_name: 'Village', loc: [2,3], controller: 1},
		                              ],
                                      
                        trophies: [
			                 [0,0,0,0,0],
			                 [0,0,0,0,0],
		                          ],
					}, me),
				},
                ])
			},
		},
        {
			title: q(Vyte Gold),
			flavor_text: q(The Vykes have accumulated a decent amount of treasure here which lays piled in their den. Nobodies left to guard it.),
			_avatar: 'bribe.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [22,18],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
                    button_text: 'Take it. (+120 gold)',
                    on_select: def()->commands 
                       [controller.spend_gold(-120),
                        controller.remove_location([22,18]),
                        controller.update_visibility(),
                       ],
                },       
                ])
			},
		},
        {
			title: q(Vyke Stockpile),
			flavor_text: q(After fighting your way into the Vyke turf you find their spells just laying around carelessly.),
			_avatar: 'bribe.png',
			_avatar_focus: [650,250],
			_avatar_scale: 0.2,
			loc: [22,15],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Take Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Tactical Maneuver), quantity: 3, price: 0},
					  {type: q(Scavenging Opportunist), quantity: 3, price: 0},
					]),
				}]),
			},
		},
        {
			title: q(Guild Retailer),
			flavor_text: q(If you've made it in here, you're qualified enough for me. I sell useful spells at a good price for those who aren't afraid to take risks or who want people dead.),
			_avatar: 'assassins-den.png',
			_avatar_focus: [650,250],
			_avatar_scale: 0.2,
			loc: [18,12],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Knife in the Dark), quantity: 3, price: 35},
					  {type: q(Guild Assassin), quantity: 3, price: 40},
                      {type: q(Cut-Throat), quantity: 3, price: 20},
                      {type: q(Cunning Rogue), quantity: 3, price: 30},
                      {type: q(Nightblade), quantity: 3, price: 35},
                      {type: q(Thieves Guild), quantity: 3, price: 40},
                      {type: q(Assassin\'s Den), quantity: 3, price: 50},
					]),
				}]),
			},
		},
        {
			title: q(Guildmaster Tanis),
			flavor_text: q(I presume you are here to challenge me? Let us begin, I won't hold it against you.),
			_avatar: 'guild-assassin.png',
			_avatar_scale: 0.2,
			_avatar_focus: [440, 180],
			loc: [18,11],
			encounter: {

				name: q(The Thieves' Guild),
				text: q(In order to even wander the streets of Marlank one must first develop a relationship with the nefarious web of organized crime that permeates the city.),
				bot_args: {
			deck: q([string] :: ['Cunning Rogue', 'Cut-Throat', 'Mercenary', 'Soothsayer']*6 + ['Outsmart the Guards', 'Knife in the Dark', 'Anthem of Battle', 'Scavenging Opportunist']*4+ ['Guild Assassin']*3),
		},
				enemy_name: q(Guildmaster Tanis),
				set: 'Scum_of_Marlank ',
				portrait: 'guild-assassin.png',
				portrait_scale: 0.2,
				portrait_translate: [306, 457],
				avatar: 'guild-assassin.png',

				theme: 'marlank',
				storyline: 'storyline_marlank1',
				music_theme: 'entropia',
				reward_gold: 160,
                
                starting_units: [
			             {card_name: 'Marlank Wall', loc: [0,3], controller: 1},
			             {card_name: 'Marlank Wall', loc: [4,3], controller: 1},
            
			             {card_name: 'Thieves Guild', loc: [1,3], controller: 1},
			             {card_name: q(Assassin's Den), loc: [2,4], controller: 1},
			             {card_name: 'Thieves Guild', loc: [3,3], controller: 1},

			             {card_name: 'Village', loc: [1,1], controller: -1},
                         {card_name: 'Village', loc: [2,3], controller: -1},
			             {card_name: 'Village', loc: [3,1], controller: -1},
		                ],
			}
		},
       {
			title: q(Cryer of the Square),
			flavor_text: q(Move away, stranger! The priests of kore roam these streets. For your safty and the safety of those on the main roads do not distrupt their procession!),
			_avatar: 'inquisitor.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [22,10],
			encounter: 
            {
		      name: q(The cryer of the square.),
		      text: q(He may have good intentions, but he's getting in the way.),
		      enemy_name: q(Cryer of the Square),
              set: q(Scum_of_Marlank),
		      bot_args: {
			     deck: q([string] :: [q(High Guard), q(Inquisitor), q(Temple Guard)]*6 + [q(Blessing of Endurance), q(Weakness), q(Silence)]*3 + [q(Dawn Obelisk), q(Shrine of the Martyr), q(Eye for an Eye)]*2),
		},
		      portrait: 'inquisitor.png',
		      portrait_scale: 0.2,
		      portrait_translate: [0, 0],
		      avatar: 'inquisitor.png',
              theme: 'marlank',
              music_theme: 'aether',
              reward_gold: 60,
            },
	},
        {
			title: q(Begger),
			flavor_text: q(Please sir, can you spare a coin? I give you a warning to make it worth your while; if you want to live avoid the south east part of town, the creatures that occasionally creep in at night all come from the alleys and sewers over there.),
			_avatar: 'scrap-tinker.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 150],
			loc: [25,13],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
                    button_text: 'Donate (-1 gold)',
                    on_select: def()->commands 
                       [controller.spend_gold(1),
                       ],
                },       
                ])
			},
		},
        {
			title: q(Scurrying in the Streets),
			flavor_text: q(As you look into this street it feels far too quiet compared to the rest of the city. The houses are all locked up tight and the streets are deserted. And yet, you can sense tiny amounts of motion here and there around the edges in places so small no man could hide. You are sure that if you enter, you'll have to fight.),
			_avatar: 'nightblade.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [26,16],
			encounter: {
		name: 'Lurkers',
		text: 'Watch your Back',
		enemy_name: 'Lurkers',
        set: 'Scum_of_Marlank',
		bot_args: {
			deck: q([string] :: [q(Swarm Rats), q(Plague Rats)]*30 + [q(Grave Stalker), q(Pain), q(Swamp), q(Rat Nest), q(Collapse)]*8),
		},
		portrait: 'nightblade.png',
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: 'nightblade.png',
        theme: 'marlank',
        music_theme: 'gaea',
        reward_gold: 5,
	   }, 
    },
     {
			title: q(Corpse Stealers),
			flavor_text: q(As you round the corner you spot lumbering forms dragging corpses in the other direction. There is no way to pass without attracting their attention.),
			_avatar: 'nightblade.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [30,13],
			encounter: {
		name: 'Corpse Stealers',
		text: 'Where are the watchmen?',
		enemy_name: 'The corpse stealers',
        set: 'Scum_of_Marlank',
		bot_args: {
			deck: q([string] :: [q(Zombie), q(Diseased Corpse)]*10 + [q(Knife in the Dark), q(Pain), q(Pestilence), q(Blood Altar)]*4),
		},
		portrait: 'nightblade.png',
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: 'nightblade.png',
        theme: 'marlank',
        music_theme: 'entropia',
        reward_gold: 30,
	   }, 
    },
    
    {
			title: q(House Under Sige),
			flavor_text: q(To your surprise you spot large beasts crowding the street as they try to break into a building. There's not a watchman in sight. Someone inside the building calls for help.),
			_avatar: 'marauder.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [28,13],
			encounter: {
		name: 'Street Beasts',
		text: 'How did they get in here?',
		enemy_name: 'Street Beasts',
        set: 'Scum_of_Marlank',
		bot_args: {
			deck: q([string] :: [q(Quillboar), q(Savage Wolf), q(Purrsan Ambusher), q(Relentless Behemeth), q(Cave Troll)]*6 + [q(Furious Rampage), q(Monsterous Growth), q(Hunting Grounds), q(Cover)]*4),
		},
		portrait: 'marauder.png',
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: 'marauder.png',
        theme: 'marlank',
        music_theme: 'entropia',
        reward_gold: 30,
	   }, 
    },
    
    {
			title: q(Santuary),
			flavor_text: q(Thank you so much for your help, any time you need to rest or meditate feel free to visit.),
			_avatar: 'greatlibrary.png',
			_avatar_focus: [400,400],
			_avatar_scale: 0.2,
			loc: [27,14],
			is_library: true,
			info: {
				handle_enter: q(def(obj story_campaign_controller controller, obj campaign_location loc) ->commands [
					controller.heal_wounds(),
				]),
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Edit Deck',
					on_select: def()->commands controller.show_library(),
				}]),
			},
		},
        
        {
			title: q(Delver Meks),
			flavor_text: q(You want to go into the sewers? You're crazy but I'll unseal them for you for the low price of 40 gold.),
			_avatar: 'deephelm-explorer.png',
			_avatar_scale: 0.2,
			_avatar_focus: [380, 240],
			loc: [34,13],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
                    button_text: 'Pay Her (-40 gold)',
                    on_select: def()->commands 
                       if(controller.player_gold >= 40,
                       [controller.spend_gold(40),
                        controller.remove_location([34,14]),
                        controller.remove_location([38,14]),
                        controller.update_visibility()]),
                },       
                ])
			},
		},
        {
			title: q(Sewer Entrance),
			flavor_text: q(The entranceway is sealed tight both with magic and machinery. Next to it is a note that reads, 'in case of an emergency, contact Delver Meks to open'),
			_avatar: 'wall-of-stone.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [34,14],
		},
        {
			title: q(Sewer Entrance),
			flavor_text: q(The entranceway is sealed tight both with magic and machinery. Next to it is a note that reads, 'in case of an emergency, contact Delver Meks to open'),
			_avatar: 'wall-of-stone.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [38,14],
		},
        {
			title: q(Hightown Sellers),
			flavor_text: q(A middle class of people live in this area. The spells and prices are varied for the variety of tastes found here.),
			_avatar: 'alliance-headquarters.png',
			_avatar_focus: [400,400],
			_avatar_scale: 0.2,
			loc: [5,18],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Deephelm Explorer), quantity: 3, price: 20},
					  {type: q(Baekwall Gargoyle), quantity: 3, price: 40},
                      {type: q(Master Fencer), quantity: 3, price: 40},
                      {type: q(Eye for an Eye), quantity: 3, price: 15},
                      {type: q(Divine Restoration), quantity: 3, price: 40},
                      {type: q(Scry), quantity: 3, price: 15},
                      {type: q(Burrow), quantity: 3, price: 25},
                      {type: q(Sir Trenis, Knight of the Thorn), quantity: 3, price: 150},
					]),
				}]),
			},
		},
        {
			title: q(Lowtown Sellers),
			flavor_text: q(The people in lowtown are practical by necesity and don't ask too much for the practical spells they offer.),
			_avatar: 'alliance-headquarters.png',
			_avatar_focus: [400,400],
			_avatar_scale: 0.2,
			loc: [29,16],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Peddler), quantity: 3, price: 15},
					  {type: q(Stoneclan Berserker), quantity: 3, price: 30},
                      {type: q(Savage Wolf), quantity: 3, price: 20},
                      {type: q(Guardian Herald), quantity: 3, price: 40},
                      {type: q(Gilbane Hatching Ground), quantity: 3, price: 30},
                      {type: q(Rally the People), quantity: 3, price: 25},
                      {type: q(Soothsayer), quantity: 3, price: 15},
                      {type: q(Bronis Benchar), quantity: 3, price: 120},
					]),
				}]),
			},
		},
        {
			title: q(Invisible Flying Fish Spells),
			flavor_text: q(This oddly named shop proudly displays advanced magics for your purchase,),
			_avatar: 'bazaar.png',
			_avatar_focus: [650,250],
			_avatar_scale: 0.2,
			loc: [16,12],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Polymorph), quantity: 3, price: 55},
					  {type: q(Fire Elemental), quantity: 3, price: 60},
                      {type: q(Water Elemental), quantity: 3, price: 40},
                      {type: q(Eji's Cunning), quantity: 3, price: 50},
                      {type: q(Spirit of Intellect), quantity: 3, price: 60},
                      {type: q(Nether Word), quantity: 3, price: 30},
                      {type: q(Intense Warfare), quantity: 3, price: 100},
                      {type: q(Haste), quantity: 3, price: 80},
                      {type: q(Thought Steal), quantity: 3, price: 50},
					]),
				}]),
			},
		},
        {
			title: q(Bazaar of the Bizarre),
			flavor_text: q(The shop keeper warns you that you may not wish to look at his wares. Though they are wonderous to behold you may find yourself chasing a dream you cannot catch.),
			_avatar: 'bazaar-of-bizarre.png',
			_avatar_focus: [650,250],
			_avatar_scale: 0.2,
			loc: [13,18],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands [controller.show_shop([
					  {type: q(Catherine, Lady of the Blade), quantity: 3, price: 200},
					  {type: q(Gezzix, Lord of Death), quantity: 3, price: 200},
                      {type: q(Grizzis, Lord of the Hunt), quantity: 3, price: 200},
                      {type: q(Rihn, Incarnate), quantity: 3, price: 200},
                      {type: q(Eji, the Summoner), quantity: 3, price: 200},
                      {type: q(Bazaar of the Bizarre), quantity: 3, price: 100},
                      {type: q(Rain of Steel), quantity: 3, price: 100},
                      {type: q(Nature's Blessing), quantity: 3, price: 40},
					]),
                    controller.remove_location([13,18])]
				}]),
			},
		},
        {
			title: q(Bazaar of the Bizarre),
			flavor_text: q(The shop keeper warns you that you may not wish to look at his wares. Though they are wonderous to behold you may find yourself chasing a dream you cannot catch.),
			_avatar: 'bazaar-of-bizarre.png',
			_avatar_focus: [650,250],
			_avatar_scale: 0.2,
			loc: [32,18],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands [controller.show_shop([
					  {type: q(Catherine, Lady of the Blade), quantity: 3, price: 200},
					  {type: q(Gezzix, Lord of Death), quantity: 3, price: 200},
                      {type: q(Grizzis, Lord of the Hunt), quantity: 3, price: 200},
                      {type: q(Rihn, Incarnate), quantity: 3, price: 200},
                      {type: q(Eji, the Summoner), quantity: 3, price: 200},
                      {type: q(Bazaar of the Bizarre), quantity: 3, price: 100},
                      {type: q(Rain of Steel), quantity: 3, price: 100},
                      {type: q(Nature's Blessing), quantity: 3, price: 40},
					]),
                    controller.remove_location([32,18])]
				}]),
			},
		},
        {
			title: q(The Cracked Soothsayer),
			flavor_text: q(I speak the truth and I rule these streets. Fight me if you dare Darbbingar! Your life ends soon! My dominion spreads!),
			_avatar: 'soothsayer.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 320],
			loc: [31,18],
			encounter: {
		name: 'The Cracked Soothsayer',
		text: 'Who is this guy?',
		enemy_name: 'Crazy Soothsayer',
        set: 'Scum_of_Marlank',
		bot_args: {
			deck: q([string] :: [q(Soothsayer), q(Acolyte), q(Crypt Fiend), q(Disfavor), q(Pyromancer)]*6 + [q(Hop, the Fool), q(Fireball), q(Pain), q(Nether Word), q(Memory Eater)]*4),
		},
		portrait: 'marauder.png',
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: 'marauder.png',
        theme: 'marlank',
        music_theme: 'entropia',
        reward_gold: 60,
	   }, 
    },
    {
			title: q(Resiliant),
			flavor_text: q(I've been trying to get people together to fight off the Vytes in the next neighborhood but people say that my group would just become another gang. You think people'd be lining up to join with me considering how much those cretins have stolen.),
			_avatar: 'mercenary.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [32,17],
    },
    {
			title: q(Corpse Seller),
			flavor_text: q(He offers a wide variety of interesting spells. You have the feeling though that if you ask where he got them, things might go sour.),
			_avatar: 'assassins-den.png',
			_avatar_focus: [650,250],
			_avatar_scale: 0.2,
			loc: [32,16],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands [controller.show_shop([
					  {type: q(Diseased Corpse), quantity: 3, price: 25},
					  {type: q(Crypt Fiend), quantity: 3, price: 15},
                      {type: q(Demanding Devlings), quantity: 3, price: 25},
                      {type: q(Grave Stalker), quantity: 3, price: 30},
                      {type: q(Memory Eater), quantity: 3, price: 40},
                      {type: q(Skeletal Parasite), quantity: 3, price: 30},
                      {type: q(Pestilence), quantity: 3, price: 50},
                      {type: q(Festering Wound), quantity: 3, price: 25},
					])]
				},
                {
					button_text: 'Ask him where he gets his spells',
					on_select: def()->commands controller.force_fight([19,16], {

						name: q(Shouldn't have asked),
						text: q(He immediately attacks),
						bot_args: {
							deck: q([string] :: ['Skeleton', 'Zombie', 'Demanding Devlings', 'Grave Stalker', 'Memory Eater', 'Skeletal Parasite']*4 + ['Pestilence', 'Festering Wound', 'Hypothermia', 'Deathly Arrow', 'Dread']*2),
						},
						enemy_name: q(Corpse Seller),
						set: 'Scum_of_Marlank',
						loc: [32,16],
						portrait: 'nightblade.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'nightblade.png',

						theme: 'marlank',
						music_theme: 'entropia',
						reward_gold: 150,
					}, me),
				}]),
			},
		},
        {
			title: q(Desperate People),
			flavor_text: q(By the side of the road are a gaggle of people. The foremost among them begs desperately for food.),
			_avatar: 'agitated_peasant.png',
			_avatar_focus: [350,250],
			_avatar_scale: 0.2,
			loc: [32,15],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Refuse',
					on_select: def()->commands controller.force_fight([19,16], {

						name: q(Desperate People),
						text: q(Sure you didn't feed them, but sheesh.),
						bot_args: {
							deck: q([string] :: ['Scrap Tinker', 'Peddler', 'Cunning Rogue']*10 + ['Highlands', 'Rally the People', 'Furious Rampage', 'Savage Lands']*5),
						},
						enemy_name: q(Desperate Mob),
						set: 'Scum_of_Marlank',
						loc: [32,15],
						portrait: 'city-watch.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'mercenary.png',

						theme: 'marlank',
						music_theme: 'materia',
						reward_gold: 10,
					}, me),
				},
                {
                    button_text: 'Donate(-10 gold)',
                    on_select: def()->commands 
                       if(controller.player_gold, [controller.spend_gold(10),
                        controller.remove_location([32,15]),
                       ]),
                },       
                ])
			},
		},
        {
			title: q(Impressive Statue),
			flavor_text: q(This strange statue pertrudes from the city walls in an odd way. You kind of feel that there's something more to it but you're not sure what.),
			_avatar: 'baekwall-gargoyle.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [8,18],
		},
        {
			title: q(Wall),
			flavor_text: q(There is nothing remarkable about this location.),
			_avatar: 'wall-of-stone.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [9,17],
		},
        {
			title: q(Impressive Statue),
			flavor_text: q(This is the statue the robed figure mentioned. You can clearly see the tail now. It looks like solid stone to you.),
			_avatar: 'baekwall-gargoyle.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [8,18],
            info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
                    button_text: 'Knock on the Tail',
                    on_select: def()->commands 
                       [controller.remove_location([9,17]),
                        controller.update_visibility()]
                },
                ])
			},
		},
        {
			title: q(Robed Figure),
			flavor_text: q(Hello friend, tell me, do you like the king?),
			_avatar: 'acolyte.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [28,10],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
                    button_text: 'Yes',
                    on_select: def()->commands 
                       null
                },
                {
                    button_text: 'No',
                    on_select: def()->commands 
                        controller.remove_location([28,10])
                },
                ])
			},
		},
        {
			title: q(Robed Figure),
			flavor_text: q(If you head to the plaza in the southwest part of town and knock on the tail of the statue there, you'll find other like minded people.),
			_avatar: 'acolyte.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [28,10],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
                    button_text: 'Interesting',
                    on_select: def()->commands 
                       [controller.remove_location([8,18])]
                },
                ])
			},
		},
        {
			title: q(The Conspirators),
			flavor_text: q(Since you have found out secret chamber, you must either swear to live for the kings death or die to maintain out secret!),
			_avatar: 'acolyte.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [11,17],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Long Live the King!',
					on_select: def()->commands [controller.force_fight([11,17], {

						name: q(Sneaky Conspirators),
						text: q(Darn Radicals),
						bot_args: {
							deck: q([string] :: ['Ilz Apprentice', 'Nightblade', 'Zombie', 'Ghost', 'Channeler', 'Bone Golem']*5 + ['Knife in the Dark', 'Polymorph', 'Counter Spell', 'Absolan, the Third Prince']*3),
						},
						enemy_name: q(The Conspirators),
						set: 'Scum_of_Marlank',
						loc: [11,17],
						portrait: 'guild-assassin.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'guild-assassin.png',

						theme: 'marlank',
						music_theme: 'sapienza',
						reward_gold: 350,
					}, me),
                    controller.remove_location([11,16])]
				},
                {
                    button_text: 'Down with the King!',
                    on_select: def()->commands 
                       [
                        controller.remove_location([11,17]),
                        controller.update_visibility(),
                       ],
                },       
                ])
			},
    },
    {
			title: q(Conspiracy Lounge),
			flavor_text: q(Now that you're offically admitted into the Secret Brotherhood, this has become an excellent place to  buy spells and replan your strategy.),
			_avatar: 'greatlibrary.png',
			_avatar_focus: [400,400],
			_avatar_scale: 0.2,
			loc: [11,16],
			is_library: true,
            info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Edit Deck',
					on_select: def()->commands controller.show_library(),
				},
                {
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Dark Knight), quantity: 3, price: 90},
					  {type: q(Intense Warfare), quantity: 3, price: 70},
					  {type: q(Blink), quantity: 3, price: 10},
					  {type: q(Channler), quantity: 3, price: 30},
					  {type: q(Morgan, the Entrancer), quantity: 3, price: 150},
					  {type: q(Collapse), quantity: 3, price: 15},
					  {type: q(Bribe), quantity: 3, price: 10},
					  {type: q(Kleptron, the Machine Man), quantity: 3, price: 200},
					  {type: q(Absolan, the Third Prince), quantity: 3, price: 150},
					]),
				}]),
              },
			},
            {
			title: q(Lone Figure),
			flavor_text: q(There's something odd about the man by the side of the road),
			_avatar: 'acolyte.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [11,14],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Approach',
					on_select: def()->commands controller.force_fight([11,14], {

						name: q(Magic Thief),
						text: q(He immeidately begins trying to steal from your mind!),
						bot_args: {
							deck: q([string] :: ['Thought Steal']*50),
						},
						enemy_name: q(Magic Thief),
						set: 'Scum_of_Marlank',
						loc: [11,14],
						portrait: 'guild-assassin.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'guild-assassin.png',

						theme: 'marlank',
						music_theme: 'sapienza',
						reward_gold: 120,
                        
                        starting_units: [
			                 {card_name: 'Mine', loc: [2,4], controller: 1},
                             {card_name: 'Mine', loc: [1,3], controller: 1},
                             {card_name: 'Mine', loc: [3,3], controller: 1},

			                 {card_name: 'Village', loc: [1,0], controller: -1},
                             {card_name: 'Village', loc: [2,1], controller: -1},
			                 {card_name: 'Village', loc: [3,0], controller: -1},
		                              ],
					}, me)
				},       
                ])
			},
        },
        {
			title: q(The Hauntied Mannor),
			flavor_text: q(This had once been a quite impressive building obviously owned by very wealthy people. However it seems that even the crooks of Marlank have left it in peace. An eerie feeling pricks at your neck as you approach),
			_avatar: 'shadow-elemental.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [3,17],
			encounter: {
		name: 'The Door Ghosts',
		text: 'What were you expecting?',
		enemy_name: 'Hauntings',
        set: 'Scum_of_Marlank',
		bot_args: {
			deck: q([string] :: [q(Ghost), q(Memory Eater), q(Spirit of Intellect), q(Pain), q(Shadow Elemental), q(Reaper Shade), q(Shadow Feast), q(Astral Walk)]*8),
		},
		portrait: 'shadow-elemental.png',
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: 'shadow-elemental.png',
        theme: 'marlank',
        music_theme: 'entropia',
        reward_gold: 30,
        
        starting_units: [],
	   }, 
    },
    
    {
			title: q(Adbandoned Treasure),
			flavor_text: q(A surprisingly large amount of wealth is just sitting there in a pile loading down a table. Blood smears around indicate that it might not be as safe as it appears though.),
			_avatar: 'bribe.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [1,17],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Take Treasure',
					on_select: def()->commands controller.force_fight([1,17], {

						name: q(Sentient House),
						text: q(Suddenly the walls start moving),
						bot_args: {
							deck: q([string] :: ['Marlank Wall']*60+['Ghost', 'Pain']*20),
						},
						enemy_name: q(Living House),
						set: 'Scum_of_Marlank',
						loc: [1,17],
						portrait: 'guild-assassin.png',
						portrait_scale: 0.2,
						portrait_translate: [306, 457],
						avatar: 'guild-assassin.png',

						theme: 'marlank',
                        storyline: 'storyline_marlankSentientHouse',
						music_theme: 'sapienza',
						reward_gold: 530,
                        
                        starting_units: [
			                 {card_name: 'Mine', loc: [0,1], controller: 1},
                             {card_name: 'Mine', loc: [0,2], controller: 1},
                             {card_name: 'Mine', loc: [0,3], controller: 1},

			                 {card_name: 'Marlank Wall', loc: [0,1], controller: 1},
                             {card_name: 'Marlank Wall', loc: [0,2], controller: 1},
			                 {card_name: 'Marlank Wall', loc: [0,3], controller: 1},
                             
                             {card_name: 'Mine', loc: [4,1], controller: 1},
                             {card_name: 'Mine', loc: [4,2], controller: 1},
                             {card_name: 'Mine', loc: [4,3], controller: 1},

			                 {card_name: 'Marlank Wall', loc: [4,1], controller: 1},
                             {card_name: 'Marlank Wall', loc: [4,2], controller: 1},
			                 {card_name: 'Marlank Wall', loc: [4,3], controller: 1},
                             
                             {card_name: 'Blood Altar', loc: [2,4], controller: 1},
		                              ],
					}, me)
				},       
                ])
			},
        },
        {
			title: q(Bribed cops),
			flavor_text: q(Sorry sir, but it's illegal to be a non-guild mage on this street. Yes that's a city ordinance, don't you see my badge?),
			_avatar: 'city-watch.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [2,13],
			encounter: {
		name: 'Bribed Cops',
		text: 'Cheaper than mercenaries',
		enemy_name: 'Sargent Vokes',
        set: 'Scum_of_Marlank',
		bot_args: {
			deck: q([string] :: [q(City Watchman), q(Watch Sargent), q(King's Rider)]*8+['Anthem of Battle', 'Blunting Rune', 'Biting Rune']*4),
		},
		portrait: 'city-watchman.png',
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: 'mercenary.png',
        theme: 'marlank',
        music_theme: 'materia',
        reward_gold: 40,
	   }, 
    },
    {
			title: q(Smith Enforcer),
			flavor_text: q(Eh? Another sneaky mage. Go away wizard, we won't allow you to steal any more guild secrets.),
			_avatar: 'mercenary.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [7,15],
			encounter: {
		name: 'Smith Guild Enforcers',
		text: 'Even the smiths in the town need to shell up.',
		enemy_name: 'Leirk',
        set: 'Scum_of_Marlank',
		bot_args: {
			deck: q([string] :: [q(Royal Armourer), q(Jaded Runesmith), q(Mercenary)]*8+['Biting Rune', 'Blunting Rune', 'Sentry Rune']*4),
		},
		portrait: 'mercenary.png',
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: 'mercenary.png',
        theme: 'marlank',
        music_theme: 'materia',
        reward_gold: 70,
	   }, 
    },
    {
			title: q(Rune Smithy),
			flavor_text: q(The man looks surprised. 'You're willing to buy our spells? Most wizards just drop in and think they're entitled to the secrets of our craft'.),
			_avatar: 'armory.png',
			_avatar_focus: [400,400],
			_avatar_scale: 0.2,
			loc: [6,14],
			is_library: true,
            info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Biting Rune), quantity: 3, price: 30},
					  {type: q(Blunting Rune), quantity: 3, price: 30},
					  {type: q(Runewall), quantity: 3, price: 40},
					  {type: q(Sentry Rune), quantity: 3, price: 40},
					  {type: q(Jaded Runesmith), quantity: 3, price: 50},
					  {type: q(Blessed Lance), quantity: 3, price: 25},
					  {type: q(Knight Errant), quantity: 3, price: 20},
					  {type: q(Siege Ballista), quantity: 3, price: 40},
					  {type: q(Oldric, Lord of the Hold), quantity: 3, price: 150},
					]),
				}]),
              },
    },
    {
			title: q(Begger),
			flavor_text: q(Please sir, can you spare a coin for a meal? I used to be a wizard in my own right. Then some knave stole all my spells!),
			_avatar: 'scrap-tinker.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 150],
			loc: [31,11],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
                    button_text: 'Donate (-1 gold)',
                    on_select: def()->commands 
                       [controller.spend_gold(1),
                       ],
                },       
                ])
			},
    },
    {
			title: q(Kore Missionary),
			flavor_text: q(By your blood! I'd soon have you as a worshipper kore! If not slay me now for he must be pleased! Should you fail, then learn from your folly and embrace the God of Strife that you may conquer in the future!),
			_avatar: 'cleric.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 200],
			loc: [34,10],
			encounter: {
		name: 'Kore Missionary',
		text: 'You must really like fighting to worship this guy.',
		enemy_name: 'Kore Missionary',
        set: 'Scum_of_Marlank',
		bot_args: {
			deck: q([string] :: [q(Priest of Kore), q(Orin's Phalanx)]*12+['Blessing of Endurance', 'Curse of the Smalls', 'Curse of the Greats']*4),
		},
		portrait: 'deephelm-explorer.png',
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: 'deephelm-explorer.png',
        theme: 'marlank',
        music_theme: 'aether',
        reward_gold: 80,
	   }, 
    },
    {
			title: q(Kore Missionary),
			flavor_text: q('The King bathes in his wealth while the streets fall into anarchy! Why, just yesterday I saw deadmen walking in the streets and not a person to oppose, and last week when the vytes murdered Folio's son! Should this be? No I say! Let us band together under the banner of justice and end this chaos!'),
			_avatar: 'cleric.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 200],
			loc: [25,14],
    },
    
    {
			title: q(Invasion),
			flavor_text: q('We're under attack!' a guard cries. A Captain of the Guard scrambles to try to get things organized. You try to ask for more details but it immediately becomes clear that if you have the slightest bit of magical ability you'll be put to the task of defending the walls. As you look over the walls you can see darkness spreading over the land but not any army in the conventional sense.),
			_avatar: q(watch-sargent.png),
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [39,10],
			encounter: {
		name: q(The Invasion),
		text: q(The City of Marlank is suffering an invasion. The inhabitants are outnumbered a hundred to one by a very cunning enemy. It'll take a brave and resourceful hero to defend against them.),
		enemy_name: q(King Snixex),
        set: q(Scum_of_Marlank),
		bot_args: {
			deck: q([string] :: ['Swarm Rats', 'Plague Rats']*30 + ['Sezear Duelist', 'Sezear Sniper', 'Collapse', q(Sezear Shaman), 'Vermintide']*9 + ['Rat Nest']*6 + ['Rezixtix: Plague Lord']*4),
		},
		portrait: q(nightblade.png),
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: q(nightblade.png),
        storyline: q(storyline_marlank3),
        theme: q(marlank),
        music_theme: 'gaea',
        reward_gold: 300,
        
        map_dimensions: [7, 5],
		map_lanes: [
			{begin: 1, length: 3},
			{begin: 0, length: 5},
			{begin: 0, length: 5},
			{begin: 0, length: 4},
			{begin: 0, length: 5},
			{begin: 0, length: 5},
			{begin: 1, length: 3},
		],
        
        trophies: [
			[8,8,15,15,15,8,8],
			[8,8,10,8,10,8,8],
		],
        
        starting_units: [
			{card_name: 'Wall of Stone', loc: [2,0], controller: 0},
			{card_name: 'Wall of Stone', loc: [3,0], controller: 0},
            {card_name: 'Wall of Stone', loc: [4,0], controller: 0},
            
			{card_name: 'Rat Nest', loc: [1,4], controller: 1},
			{card_name: 'Rat Nest', loc: [5,4], controller: 1},
            
            {card_name: 'Faerie Woods', loc: [1,4], controller: 1},
			{card_name: 'Faerie Woods', loc: [5,4], controller: 1},

			{card_name: 'Village', loc: [0,2], controller: -1},
            {card_name: 'Village', loc: [2,2], controller: -1},
            {card_name: 'Village', loc: [4,2], controller: -1},
			{card_name: 'Village', loc: [6,2], controller: -1},
		              ],
	   }, 
    },

    {
			title: q(More Entrance Campers),
			flavor_text: q(The East Gate is the other main entrance and the merchants their it's gate engage in similar practices to their south gate bretheren.),
			_avatar: 'bazaar.png',
			_avatar_focus: [650,250],
			_avatar_scale: 0.2,
			loc: [36,10],
			is_library: true,
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Elven Condatiare), quantity: 3, price: 45},
					  {type: q(Fearless Leader), quantity: 3, price: 60},
					  {type: q(If-Uluk, the Swift), quantity: 3, price: 160},
					  {type: q(Relentless Behemeth), quantity: 3, price: 50},
					  {type: q(Murkill Hag), quantity: 3, price: 60},
					  {type: q(Endless Studies), quantity: 3, price: 30},
					  {type: q(Slave Trader), quantity: 3, price: 50},
					  {type: q(Zupadin's Moving Castle), quantity: 3, price: 350},
					  {type: q(Mage Tower), quantity: 3, price: 80},
					  {type: q(Active Temple), quantity: 3, price: 60},
                      {type: q(High Guard), quantity: 3, price: 45},
					]),
				}]),
			},
		},
        {
			title: q(Slave Trader),
			flavor_text: q('Fine slaves for sale! Available in spell form too!' the man calls out. The prices he asks are reasonable but looking at the lineup you are quite certain that not all of these were those who couldn't pay their debt.),
			_avatar: 'slave-trader.png',
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [37,12],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Rihn's Martyr), quantity: 3, price: 20},
					  {type: q(Hillclan Auxillery), quantity: 3, price: 20},
					  {type: q(Ilz Apprentice), quantity: 3, price: 20},
					  {type: q(Soothsayer), quantity: 3, price: 20},
					  {type: q(Darkwood Denizen), quantity: 3, price: 20},
					  {type: q(Hop, the Fool), quantity: 3, price: 70},
					]),
				}]),
			}, 
    },
    {
			title: q(Sezear Merchant),
			flavor_text: q(To your slight bewilderment off to the side of the sewer you find a proper shop front with a colourful sign. The rodentlike shopkeeper behind the counter calls you over cordinally though he chews on his wiskers as he speaks to you.),
			_avatar: 'outsmart-the-guards.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [36,14],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[{
					button_text: 'Buy Spells',
					on_select: def()->commands controller.show_shop([
					  {type: q(Swarm Rats), quantity: 3, price: 10},
                      {type: q(Skeletal Rats), quantity: 3, price: 10},
					  {type: q(Plague Rats), quantity: 3, price: 15},
					  {type: q(Sezear Duelist), quantity: 3, price: 25},
					  {type: q(Sezear Sniper), quantity: 3, price: 25},
                      {type: q(Sezear Shaman), quantity: 3, price: 30},
					  {type: q(Rezixtix: Plague Lord), quantity: 3, price: 100},
					  {type: q(Vermintide), quantity: 3, price: 20},
                      {type: q(Sink), quantity: 3, price: 30},
                      {type: q(Festering Wound), quantity: 3, price: 30},
					]),
				}]),
			}, 
    },
    {
			title: q(Rat Mound),
			flavor_text: q(A gloriously large pile of junk has been accumulated in this large chamber. But amid the piles of random filth is a fine collection of shiny objects. Coins, and gems, and genuine silverware.),
			_avatar: 'bribe.png',
			_avatar_scale: 0.2,
			_avatar_focus: [306, 457],
			loc: [38,16],
			info: {
				get_choices: q(def(obj story_campaign_controller controller) -> [{button_text: string, on_select: function()->commands}]
				[
                {
                    button_text: 'Loot it (+340 gold)',
                    on_select: def()->commands 
                       [controller.spend_gold(-340),
                        controller.remove_location([40,16])
                       ],
                },       
                ])
			},
    },
    {
			title: q(Tight Fighting),
			flavor_text: q(In the cramped tunnels you can see by the light of your magic hundreds of tiny glistening eyes.),
			_avatar: q(rezixtix.png),
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [35,18],
			encounter: {
		name: q(Tight Fighting),
		text: q(Yech),
		enemy_name: q(Creatures of the Dark),
        set: q(Scum_of_Marlank),
		bot_args: {
			deck: q([string] :: ['Skeletal Rats']*28 + ['Diseased Corpse', 'Pestilence', 'Festering Wound', 'Blood Altar', 'Sink']*4),
		},
		portrait: q(nightblade.png),
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: q(nightblade.png),
        theme: q(marlank),
        music_theme: 'entropia',
        reward_gold: 20,
        
        map_dimensions: [3, 6],
		map_lanes: [
			{begin: 0, length: 6},
			{begin: 0, length: 5},
			{begin: 0, length: 6},
		],
        
        trophies: [
			[18,12,18],
			[10,15,10],
		],
        
        starting_units: 
            [
			{card_name: 'Swamp', loc: [1,0], controller: 1},
            {card_name: 'Swamp', loc: [1,1], controller: 1},
            {card_name: 'Swamp', loc: [1,2], controller: 1},
            {card_name: 'Swamp', loc: [1,3], controller: 1},
            {card_name: 'Swamp', loc: [1,4], controller: 1},
            ],
	   }, 
    },
    
    {
			title: q(Ratmen),
			flavor_text: q(Walking around the narrow coridors of the tunnel you spot several armed Sezear moving toward you.),
			_avatar: q(rezixtix.png),
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [37,14],
			encounter: {
		name: q(Tight FightingII),
		text: q(Even more of a ripoff),
		enemy_name: q(Sezear Warriors),
        set: q(Scum_of_Marlank),
		bot_args: {
			deck: q([string] :: ['Sezear Duelist', 'Sezear Sniper, 'Sezear Shaman']*10 + ['Knife in the Dark', 'Deathly Arrow']*5),
		},
		portrait: q(nightblade.png),
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: q(nightblade.png),
        storyline: q(storyline_marlank3),
        theme: q(marlank),
        music_theme: 'entropia',
        reward_gold: 80,
        
        map_dimensions: [3, 6],
		map_lanes: [
			{begin: 0, length: 6},
			{begin: 0, length: 5},
			{begin: 0, length: 6},
		],
        
        trophies: [
			[18,12,18],
			[10,15,10],
		],
        
        starting_units: 
            [
			{card_name: 'Swamp', loc: [1,0], controller: 1},
            {card_name: 'Swamp', loc: [1,1], controller: 1},
            {card_name: 'Swamp', loc: [1,2], controller: 1},
            {card_name: 'Swamp', loc: [1,3], controller: 1},
            {card_name: 'Swamp', loc: [1,4], controller: 1},
            ],
	   }, 
    },

    {
			title: q(Odd place to live),
			flavor_text: q(This area is a little more open but no more plesant. You can see a necromancer building himself an empire of decay. He looks at you and grins.),
			_avatar: q(rezixtix.png),
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [38,17],
			encounter: {
		name: q(Odd place to Live),
		text: q(Yech),
		enemy_name: q(Ser Danx),
        set: q(Scum_of_Marlank),
		bot_args: {
			deck: q([string] :: ['Skeletal Rats', 'Swarm Rats', 'Plague Rats']*10 + ['Grave Stalker', 'Hypothermia', 'Festering Wound', 'Dark Emissary', 'Sink']*6),
		},
		portrait: q(nightblade.png),
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: q(nightblade.png),
        theme: q(marlank),
        music_theme: 'entropia',
        reward_gold: 100,
        
        starting_units: 
            [
			{card_name: 'Swamp', loc: [1,0], controller: 1},
            {card_name: 'Swamp', loc: [1,1], controller: 1},
            {card_name: 'Swamp', loc: [1,2], controller: 1},
            ],
	   }, 
    },
    
    {
			title: q(Slavers),
			flavor_text: q(As you enter this side street you spot a couple men attacking a walker ahead of you. But rather than simply plunder the man they immediately start carving slave runes into the man. You can intervene but you risk the same fate.),
			_avatar: q(slave-trader.png),
			_avatar_scale: 0.2,
			_avatar_focus: [350, 250],
			loc: [38,9],
			loc: [38,9],
			encounter: {
		name: q(Slavers),
		text: q(There ought to be a law.),
		enemy_name: q(Slavers),
        set: q(Scum_of_Marlank),
		bot_args: {
			deck: q([string] :: ['Slave Trader', 'Ilz Apprentice', 'Darkwood Denizen', q(Rihn's Martyr), q(Soothsayer), q(Hillclan Auxillery), 'Anthem of Battle', 'Silence', 'Weakness', 'Hypothermia']*5),
		},
		portrait: q(nightblade.png),
		portrait_scale: 0.2,
		portrait_translate: [0, 0],
		avatar: q(nightblade.png),
        theme: q(marlank),
        music_theme: 'entropia',
        reward_gold: 40,
	   }, 
    },
    
		]",
	},

}
