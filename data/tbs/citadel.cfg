{
	handlers: {
		start: "set(doc, construct('game',
		                 {
		         players: map(range(2),
				        construct('player',
				            {
								player_index: value,
								deck: shuffled_deck[7:],
								hand: shuffled_deck[0:7]
							} where shuffled_deck =
								shuffle(map(['Vampire Lord']*4 + ['Vampire']*4 + ['Vampire Bat'] + ['Dark Emissary']*4,
						         construct('card', get_document('data/cards.cfg')[value])))) )
				          }))",

		message: "[debug('got message: ' + message.type), switch(message.type,
		  'play_card',
		  if(player = doc.current_player, doc.play_card(message)),
		  'add_bot',
		  set(bots, [{
		    script: [{
				session_id: 2,
				send: {
					type: 'request_updates',
				}
			}],

			on_create: q(set(data, construct('bot', {session_id: 2}))),

			on_message: q(data.handle_message(message, me)),
		  }]),
		  'play_ability',
		  [debug('play ability'), doc.log_message('ggg'), if(player = doc.current_player, doc.play_ability(message))],
		  'end_turn',
		  if(player = doc.current_player, doc.end_turn(message))
		)]",

		transform: "[set(message.nplayer, nplayer)]",
	}
}
